<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Workspace Setup - Mewayz Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .setup-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .setup-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .setup-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .setup-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .progress-container {
            margin-bottom: 40px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .step-indicators {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .step-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        
        .step-indicator.active {
            opacity: 1;
        }
        
        .step-indicator.completed {
            opacity: 1;
            color: #28a745;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 8px;
            transition: background 0.3s ease;
        }
        
        .step-indicator.active .step-number {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .step-indicator.completed .step-number {
            background: #28a745;
            color: white;
        }
        
        .step-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .step-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .goal-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .goal-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .goal-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .goal-card.primary {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .goal-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .goal-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .goal-description {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .feature-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .feature-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .feature-name {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .feature-description {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .pricing-card {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .pricing-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }
        
        .pricing-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .pricing-card.recommended {
            border-color: #28a745;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .plan-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .plan-price {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .plan-features {
            text-align: left;
            margin-bottom: 20px;
        }
        
        .plan-features li {
            margin-bottom: 8px;
            list-style: none;
            padding-left: 20px;
            position: relative;
        }
        
        .plan-features li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-picker input[type="color"] {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-message {
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .completion-screen {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 20px;
            margin-top: 20px;
        }
        
        .completion-screen h2 {
            font-size: 3em;
            margin-bottom: 20px;
        }
        
        .completion-screen p {
            font-size: 1.3em;
            margin-bottom: 30px;
        }
        
        .auth-section {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            color: white;
        }
        
        .auth-section h3 {
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .auth-section input {
            margin: 10px;
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .auth-section input::placeholder {
            color: rgba(255,255,255,0.7);
        }
        
        .auth-section button {
            margin: 10px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        
        .auth-section button:hover {
            transform: translateY(-2px);
        }
        
        .pricing-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #e0e0e0;
        }
        
        .pricing-summary h4 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .pricing-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .pricing-total {
            font-weight: bold;
            font-size: 1.2em;
            padding-top: 10px;
            border-top: 2px solid #667eea;
            color: #667eea;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="setup-header">
            <h1>ðŸš€ Welcome to Mewayz</h1>
            <p>Let's set up your all-in-one business platform</p>
        </div>
        
        <!-- Authentication Section -->
        <div class="auth-section" id="authSection">
            <h3>Login to Continue</h3>
            <p>Please log in to access the enhanced workspace setup wizard</p>
            <input type="email" id="loginEmail" placeholder="admin@example.com" value="admin@example.com">
            <input type="password" id="loginPassword" placeholder="Password" value="admin123">
            <button onclick="login()">Login</button>
        </div>
        
        <!-- Main Setup Card -->
        <div class="setup-card" id="setupCard" style="display: none;">
            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="step-indicators">
                    <div class="step-indicator active" id="stepIndicator1">
                        <div class="step-number">1</div>
                        <div>Main Goals</div>
                    </div>
                    <div class="step-indicator" id="stepIndicator2">
                        <div class="step-number">2</div>
                        <div>Features</div>
                    </div>
                    <div class="step-indicator" id="stepIndicator3">
                        <div class="step-number">3</div>
                        <div>Team</div>
                    </div>
                    <div class="step-indicator" id="stepIndicator4">
                        <div class="step-number">4</div>
                        <div>Subscription</div>
                    </div>
                    <div class="step-indicator" id="stepIndicator5">
                        <div class="step-number">5</div>
                        <div>Branding</div>
                    </div>
                    <div class="step-indicator" id="stepIndicator6">
                        <div class="step-number">6</div>
                        <div>Review</div>
                    </div>
                </div>
            </div>
            
            <!-- Step 1: Main Goals -->
            <div class="step-content active" id="step1Content">
                <h2>Step 1: Choose Your Main Goals</h2>
                <p>Select the business goals that matter most to you. You can choose multiple goals.</p>
                <div class="goals-grid" id="goalsGrid">
                    <!-- Goals will be populated here -->
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="businessType">Business Type *</label>
                        <select id="businessType" required>
                            <option value="">Select your business type</option>
                            <option value="startup">Startup</option>
                            <option value="small_business">Small Business</option>
                            <option value="medium_business">Medium Business</option>
                            <option value="enterprise">Enterprise</option>
                            <option value="freelancer">Freelancer</option>
                            <option value="agency">Agency</option>
                            <option value="ecommerce">E-commerce</option>
                            <option value="saas">SaaS</option>
                            <option value="consultant">Consultant</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="targetAudience">Target Audience *</label>
                    <textarea id="targetAudience" placeholder="Describe your target audience..." required></textarea>
                </div>
            </div>
            
            <!-- Step 2: Feature Selection -->
            <div class="step-content" id="step2Content">
                <h2>Step 2: Select Your Features</h2>
                <p>Choose the features you need based on your selected goals.</p>
                <div class="features-grid" id="featuresGrid">
                    <!-- Features will be populated here -->
                </div>
                <div class="pricing-summary" id="pricingSummary">
                    <h4>Pricing Summary</h4>
                    <div class="pricing-row">
                        <span>Selected Features:</span>
                        <span id="selectedFeatureCount">0</span>
                    </div>
                    <div class="pricing-row">
                        <span>Monthly Cost:</span>
                        <span id="monthlyCost">$0</span>
                    </div>
                    <div class="pricing-row pricing-total">
                        <span>Total:</span>
                        <span id="totalCost">$0/month</span>
                    </div>
                </div>
            </div>
            
            <!-- Step 3: Team Setup -->
            <div class="step-content" id="step3Content">
                <h2>Step 3: Set Up Your Team</h2>
                <p>Invite team members and define their roles (optional).</p>
                <div class="form-group">
                    <label>Team Members</label>
                    <div id="teamMembersContainer">
                        <div class="form-row">
                            <div class="form-group">
                                <input type="email" placeholder="Email address" class="team-email">
                            </div>
                            <div class="form-group">
                                <select class="team-role">
                                    <option value="admin">Admin</option>
                                    <option value="editor">Editor</option>
                                    <option value="viewer">Viewer</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="addTeamMember()">Add Team Member</button>
                </div>
            </div>
            
            <!-- Step 4: Subscription Selection -->
            <div class="step-content" id="step4Content">
                <h2>Step 4: Choose Your Subscription Plan</h2>
                <p>Select the plan that best fits your needs.</p>
                <div class="pricing-cards" id="pricingCards">
                    <!-- Pricing cards will be populated here -->
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="billingCycle">Billing Cycle</label>
                        <select id="billingCycle">
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly (Save 17%)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Step 5: Branding Configuration -->
            <div class="step-content" id="step5Content">
                <h2>Step 5: Configure Your Branding</h2>
                <p>Set up your brand identity and appearance.</p>
                <div class="form-row">
                    <div class="form-group">
                        <label for="companyName">Company Name *</label>
                        <input type="text" id="companyName" required>
                    </div>
                    <div class="form-group">
                        <label for="brandVoice">Brand Voice</label>
                        <select id="brandVoice">
                            <option value="professional">Professional</option>
                            <option value="casual">Casual</option>
                            <option value="friendly">Friendly</option>
                            <option value="authoritative">Authoritative</option>
                            <option value="playful">Playful</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="primaryColor">Primary Color</label>
                        <div class="color-picker">
                            <input type="color" id="primaryColor" value="#667eea">
                            <input type="text" id="primaryColorText" value="#667eea" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="secondaryColor">Secondary Color</label>
                        <div class="color-picker">
                            <input type="color" id="secondaryColor" value="#764ba2">
                            <input type="text" id="secondaryColorText" value="#764ba2" readonly>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 6: Final Review -->
            <div class="step-content" id="step6Content">
                <h2>Step 6: Final Review</h2>
                <p>Review your selections and complete the setup.</p>
                <div id="reviewSummary">
                    <!-- Summary will be populated here -->
                </div>
            </div>
            
            <!-- Navigation Buttons -->
            <div class="navigation-buttons">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">Previous</button>
                <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next</button>
            </div>
        </div>
        
        <!-- Completion Screen -->
        <div class="completion-screen hidden" id="completionScreen">
            <h2>ðŸŽ‰ Welcome to Mewayz!</h2>
            <p>Your workspace has been set up successfully!</p>
            <p>You're ready to start building your business with our all-in-one platform.</p>
            <a href="/console" class="btn btn-primary">Go to Dashboard</a>
        </div>
        
        <!-- Status Messages -->
        <div id="statusMessage"></div>
    </div>

    <script>
        let currentStep = 1;
        let authToken = null;
        let setupData = {
            goals: [],
            features: [],
            teamMembers: [],
            subscription: {},
            branding: {}
        };
        let availableGoals = {};
        let availableFeatures = {};
        let subscriptionPlans = {};
        let selectedGoals = [];
        let selectedFeatures = [];
        let primaryGoal = null;
        let selectedPlan = 'free';
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeColorPickers();
        });
        
        // Authentication
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    authToken = data.token;
                    document.getElementById('authSection').style.display = 'none';
                    document.getElementById('setupCard').style.display = 'block';
                    
                    await loadInitialData();
                } else {
                    showStatus('Login failed: ' + data.message, 'error');
                }
            } catch (error) {
                showStatus('Login failed: ' + error.message, 'error');
            }
        }
        
        // Load initial data
        async function loadInitialData() {
            try {
                // Load main goals
                const goalsResponse = await apiRequest('/api/workspace-setup/main-goals', 'GET');
                if (goalsResponse.success) {
                    availableGoals = goalsResponse.goals;
                    renderGoals();
                }
                
                // Load subscription plans
                const plansResponse = await apiRequest('/api/workspace-setup/subscription-plans', 'GET');
                if (plansResponse.success) {
                    subscriptionPlans = plansResponse.plans;
                    renderPricingCards();
                }
                
                // Load current step
                const currentResponse = await apiRequest('/api/workspace-setup/current-step', 'GET');
                if (currentResponse.success) {
                    currentStep = currentResponse.current_step;
                    updateUI();
                }
                
            } catch (error) {
                showStatus('Error loading data: ' + error.message, 'error');
            }
        }
        
        // API request helper
        async function apiRequest(url, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            const response = await fetch(url, options);
            return await response.json();
        }
        
        // Render goals
        function renderGoals() {
            const goalsGrid = document.getElementById('goalsGrid');
            goalsGrid.innerHTML = '';
            
            Object.keys(availableGoals).forEach(goalId => {
                const goal = availableGoals[goalId];
                const goalCard = document.createElement('div');
                goalCard.className = 'goal-card';
                goalCard.onclick = () => toggleGoal(goalId);
                
                goalCard.innerHTML = `
                    <div class="goal-icon">${goal.icon}</div>
                    <div class="goal-name">${goal.name}</div>
                    <div class="goal-description">${goal.description}</div>
                `;
                
                goalsGrid.appendChild(goalCard);
            });
        }
        
        // Toggle goal selection
        function toggleGoal(goalId) {
            const goalCard = event.currentTarget;
            
            if (selectedGoals.includes(goalId)) {
                selectedGoals = selectedGoals.filter(id => id !== goalId);
                goalCard.classList.remove('selected');
                if (primaryGoal === goalId) {
                    primaryGoal = null;
                    goalCard.classList.remove('primary');
                }
            } else {
                selectedGoals.push(goalId);
                goalCard.classList.add('selected');
                if (!primaryGoal) {
                    primaryGoal = goalId;
                    goalCard.classList.add('primary');
                }
            }
            
            // Update primary goal if needed
            if (selectedGoals.length === 1 && !primaryGoal) {
                primaryGoal = selectedGoals[0];
                goalCard.classList.add('primary');
            }
        }
        
        // Set primary goal
        function setPrimaryGoal(goalId) {
            if (!selectedGoals.includes(goalId)) return;
            
            // Remove primary class from all goals
            document.querySelectorAll('.goal-card').forEach(card => {
                card.classList.remove('primary');
            });
            
            // Add primary class to selected goal
            primaryGoal = goalId;
            event.currentTarget.classList.add('primary');
        }
        
        // Load available features
        async function loadAvailableFeatures() {
            try {
                const response = await apiRequest('/api/workspace-setup/available-features', 'GET', {
                    selected_goals: selectedGoals
                });
                
                if (response.success) {
                    availableFeatures = response.features;
                    renderFeatures();
                }
            } catch (error) {
                showStatus('Error loading features: ' + error.message, 'error');
            }
        }
        
        // Render features
        function renderFeatures() {
            const featuresGrid = document.getElementById('featuresGrid');
            featuresGrid.innerHTML = '';
            
            Object.keys(availableFeatures).forEach(featureId => {
                const feature = availableFeatures[featureId];
                const featureCard = document.createElement('div');
                featureCard.className = 'feature-card';
                featureCard.onclick = () => toggleFeature(featureId);
                
                featureCard.innerHTML = `
                    <div class="feature-name">${feature.name}</div>
                    <div class="feature-description">${feature.description}</div>
                `;
                
                featuresGrid.appendChild(featureCard);
            });
        }
        
        // Toggle feature selection
        function toggleFeature(featureId) {
            const featureCard = event.currentTarget;
            
            if (selectedFeatures.includes(featureId)) {
                selectedFeatures = selectedFeatures.filter(id => id !== featureId);
                featureCard.classList.remove('selected');
            } else {
                selectedFeatures.push(featureId);
                featureCard.classList.add('selected');
            }
            
            updatePricingSummary();
        }
        
        // Update pricing summary
        function updatePricingSummary() {
            const featureCount = selectedFeatures.length;
            const planConfig = subscriptionPlans[selectedPlan];
            
            let monthlyCost = 0;
            if (selectedPlan !== 'free') {
                monthlyCost = featureCount * planConfig.price_monthly;
            }
            
            document.getElementById('selectedFeatureCount').textContent = featureCount;
            document.getElementById('monthlyCost').textContent = `$${monthlyCost}`;
            document.getElementById('totalCost').textContent = `$${monthlyCost}/month`;
        }
        
        // Render pricing cards
        function renderPricingCards() {
            const pricingCards = document.getElementById('pricingCards');
            pricingCards.innerHTML = '';
            
            Object.keys(subscriptionPlans).forEach(planId => {
                const plan = subscriptionPlans[planId];
                const pricingCard = document.createElement('div');
                pricingCard.className = 'pricing-card';
                if (planId === 'professional') {
                    pricingCard.classList.add('recommended');
                }
                pricingCard.onclick = () => selectPlan(planId);
                
                let priceText = planId === 'free' ? 'Free' : `$${plan.price_monthly}/feature/month`;
                
                pricingCard.innerHTML = `
                    <div class="plan-name">${plan.name}</div>
                    <div class="plan-price">${priceText}</div>
                    <ul class="plan-features">
                        <li>Max features: ${plan.max_features}</li>
                        <li>${plan.branding}</li>
                        <li>${plan.support}</li>
                    </ul>
                `;
                
                pricingCards.appendChild(pricingCard);
            });
        }
        
        // Select subscription plan
        function selectPlan(planId) {
            selectedPlan = planId;
            
            document.querySelectorAll('.pricing-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            updatePricingSummary();
        }
        
        // Add team member
        function addTeamMember() {
            const container = document.getElementById('teamMembersContainer');
            const memberRow = document.createElement('div');
            memberRow.className = 'form-row';
            
            memberRow.innerHTML = `
                <div class="form-group">
                    <input type="email" placeholder="Email address" class="team-email">
                </div>
                <div class="form-group">
                    <select class="team-role">
                        <option value="admin">Admin</option>
                        <option value="editor">Editor</option>
                        <option value="viewer">Viewer</option>
                    </select>
                </div>
            `;
            
            container.appendChild(memberRow);
        }
        
        // Initialize color pickers
        function initializeColorPickers() {
            const colorInputs = ['primaryColor', 'secondaryColor'];
            colorInputs.forEach(colorId => {
                const colorInput = document.getElementById(colorId);
                const textInput = document.getElementById(colorId + 'Text');
                
                if (colorInput && textInput) {
                    colorInput.addEventListener('input', function() {
                        textInput.value = this.value;
                    });
                }
            });
        }
        
        // Navigation
        async function nextStep() {
            if (currentStep === 6) {
                await completeSetup();
            } else {
                if (await saveCurrentStep()) {
                    currentStep++;
                    updateUI();
                    
                    // Load features when moving to step 2
                    if (currentStep === 2) {
                        await loadAvailableFeatures();
                    }
                }
            }
        }
        
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateUI();
            }
        }
        
        // Update UI
        function updateUI() {
            // Update progress bar
            const progressPercent = ((currentStep - 1) / 5) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            
            // Update step indicators
            for (let i = 1; i <= 6; i++) {
                const indicator = document.getElementById(`stepIndicator${i}`);
                indicator.classList.remove('active', 'completed');
                
                if (i === currentStep) {
                    indicator.classList.add('active');
                } else if (i < currentStep) {
                    indicator.classList.add('completed');
                }
            }
            
            // Show/hide step content
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`step${currentStep}Content`).classList.add('active');
            
            // Update navigation buttons
            document.getElementById('prevBtn').style.display = currentStep > 1 ? 'inline-block' : 'none';
            document.getElementById('nextBtn').textContent = currentStep === 6 ? 'Complete Setup' : 'Next';
        }
        
        // Save current step
        async function saveCurrentStep() {
            let endpoint = '';
            let data = {};
            
            try {
                switch (currentStep) {
                    case 1:
                        if (selectedGoals.length === 0) {
                            showStatus('Please select at least one goal', 'error');
                            return false;
                        }
                        if (!primaryGoal) {
                            showStatus('Please select a primary goal', 'error');
                            return false;
                        }
                        
                        endpoint = '/api/workspace-setup/main-goals';
                        data = {
                            selected_goals: selectedGoals,
                            primary_goal: primaryGoal,
                            business_type: document.getElementById('businessType').value,
                            target_audience: document.getElementById('targetAudience').value
                        };
                        break;
                        
                    case 2:
                        if (selectedFeatures.length === 0) {
                            showStatus('Please select at least one feature', 'error');
                            return false;
                        }
                        
                        endpoint = '/api/workspace-setup/feature-selection';
                        data = {
                            selected_features: selectedFeatures,
                            subscription_plan: selectedPlan
                        };
                        break;
                        
                    case 3:
                        const teamMembers = [];
                        document.querySelectorAll('#teamMembersContainer .form-row').forEach(row => {
                            const email = row.querySelector('.team-email').value;
                            const role = row.querySelector('.team-role').value;
                            if (email.trim()) {
                                teamMembers.push({ email, role });
                            }
                        });
                        
                        endpoint = '/api/workspace-setup/team-setup';
                        data = {
                            team_members: teamMembers
                        };
                        break;
                        
                    case 4:
                        endpoint = '/api/workspace-setup/subscription-selection';
                        data = {
                            subscription_plan: selectedPlan,
                            billing_cycle: document.getElementById('billingCycle').value
                        };
                        break;
                        
                    case 5:
                        endpoint = '/api/workspace-setup/branding-configuration';
                        data = {
                            company_name: document.getElementById('companyName').value,
                            brand_voice: document.getElementById('brandVoice').value,
                            primary_color: document.getElementById('primaryColor').value,
                            secondary_color: document.getElementById('secondaryColor').value
                        };
                        break;
                        
                    default:
                        return true;
                }
                
                const response = await apiRequest(endpoint, 'POST', data);
                
                if (response.success) {
                    showStatus(response.message, 'success');
                    return true;
                } else {
                    showStatus('Error: ' + response.error, 'error');
                    return false;
                }
                
            } catch (error) {
                showStatus('Error saving step: ' + error.message, 'error');
                return false;
            }
        }
        
        // Complete setup
        async function completeSetup() {
            try {
                const response = await apiRequest('/api/workspace-setup/complete', 'POST');
                
                if (response.success) {
                    document.getElementById('setupCard').style.display = 'none';
                    document.getElementById('completionScreen').classList.remove('hidden');
                    showStatus(response.message, 'success');
                } else {
                    showStatus('Error completing setup: ' + response.error, 'error');
                }
                
            } catch (error) {
                showStatus('Error completing setup: ' + error.message, 'error');
            }
        }
        
        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // Initialize UI
        updateUI();
    </script>
</body>
</html>