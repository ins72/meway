<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Document Editing Tools - Demo</title>
    <link rel="stylesheet" href="/css/websocket-collaboration.css">
    <link rel="stylesheet" href="/css/advanced-document-editing.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        
        .demo-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .demo-header h1 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 32px;
        }
        
        .demo-header p {
            color: #666;
            font-size: 16px;
            margin: 0;
        }
        
        .editor-tabs {
            display: flex;
            gap: 2px;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .editor-tab {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            color: #666;
        }
        
        .editor-tab:hover {
            background: #f0f0f0;
        }
        
        .editor-tab.active {
            background: #007bff;
            color: white;
        }
        
        .editor-content {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 600px;
        }
        
        .editor-container {
            display: none;
        }
        
        .editor-container.active {
            display: block;
        }
        
        .demo-features {
            margin-top: 30px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .demo-features h3 {
            color: #333;
            margin-top: 0;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .feature-card h4 {
            color: #007bff;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .feature-card p {
            color: #666;
            font-size: 14px;
            margin: 0;
        }
        
        .collaboration-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .collaboration-info h4 {
            color: #1976d2;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .collaboration-info p {
            color: #0d47a1;
            margin: 0;
        }
        
        .demo-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .demo-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .demo-btn:hover {
            background: #0056b3;
        }
        
        .demo-btn.secondary {
            background: #6c757d;
        }
        
        .demo-btn.secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>Advanced Document Editing Tools</h1>
            <p>Real-time collaborative editing with rich text, code, whiteboard, and table editors</p>
        </div>
        
        <div class="collaboration-info">
            <h4>ðŸ”— Real-time Collaboration Active</h4>
            <p>All editors support real-time collaboration with live cursors, simultaneous editing, and instant synchronization across users.</p>
        </div>
        
        <!-- Hidden data for WebSocket client -->
        <div style="display: none;">
            <div data-workspace-id="demo-advanced-editors-789"></div>
            <div data-auth-token="2|iT0DSxrTDxhrw6YfOoAp0KRzFc1q9MGXpLocVFQdc9775ef2"></div>
            <div data-current-user='{"id": 2, "name": "Advanced Editor User", "email": "editor@advanced.com"}'></div>
        </div>
        
        <div class="editor-tabs">
            <button class="editor-tab active" data-editor="rich-text">Rich Text Editor</button>
            <button class="editor-tab" data-editor="code">Code Editor</button>
            <button class="editor-tab" data-editor="whiteboard">Whiteboard</button>
            <button class="editor-tab" data-editor="table">Table Editor</button>
        </div>
        
        <div class="editor-content">
            <!-- Rich Text Editor -->
            <div class="editor-container active" data-editor="rich-text">
                <div id="rich-text-editor-container"></div>
            </div>
            
            <!-- Code Editor -->
            <div class="editor-container" data-editor="code">
                <div id="code-editor-container"></div>
            </div>
            
            <!-- Whiteboard -->
            <div class="editor-container" data-editor="whiteboard">
                <div id="whiteboard-container"></div>
            </div>
            
            <!-- Table Editor -->
            <div class="editor-container" data-editor="table">
                <div id="table-editor-container"></div>
            </div>
        </div>
        
        <div class="demo-actions">
            <button class="demo-btn" onclick="initializeCollaboration()">Initialize Collaboration</button>
            <button class="demo-btn secondary" onclick="simulateMultipleUsers()">Simulate Multiple Users</button>
            <button class="demo-btn secondary" onclick="exportAllContent()">Export All Content</button>
            <button class="demo-btn secondary" onclick="showCollaborationStats()">Show Collaboration Stats</button>
        </div>
        
        <div class="demo-features">
            <h3>ðŸš€ Advanced Features</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Rich Text Editor</h4>
                    <p>WYSIWYG editing with formatting tools, tables, images, links, comments, and version history.</p>
                </div>
                <div class="feature-card">
                    <h4>Code Editor</h4>
                    <p>Syntax highlighting, auto-completion, find/replace, multi-language support, and collaborative coding.</p>
                </div>
                <div class="feature-card">
                    <h4>Whiteboard</h4>
                    <p>Drawing tools, shapes, text, collaborative sketching, zoom controls, and real-time cursor tracking.</p>
                </div>
                <div class="feature-card">
                    <h4>Table Editor</h4>
                    <p>Spreadsheet-like functionality with formulas, sorting, filtering, collaborative cell editing, and data import/export.</p>
                </div>
                <div class="feature-card">
                    <h4>Real-time Collaboration</h4>
                    <p>Live cursors, simultaneous editing, conflict resolution, user presence indicators, and instant synchronization.</p>
                </div>
                <div class="feature-card">
                    <h4>Advanced Features</h4>
                    <p>Comments, version history, collaborative sessions, activity feed, and comprehensive formatting options.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- WebSocket and Editor Scripts -->
    <script src="/js/websocket-client.js"></script>
    <script src="/js/collaborative-rich-text-editor.js"></script>
    <script src="/js/collaborative-code-editor.js"></script>
    <script src="/js/collaborative-whiteboard.js"></script>
    <script src="/js/collaborative-table-editor.js"></script>
    
    <script>
        // Global variables
        let wsClient = null;
        let documentEditor = null;
        let richTextEditor = null;
        let codeEditor = null;
        let whiteboard = null;
        let tableEditor = null;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeEditors();
            setupTabSwitching();
            autoInitializeCollaboration();
        });
        
        function initializeEditors() {
            // Initialize WebSocket client
            wsClient = new WebSocketClient({
                baseUrl: 'ws://localhost:6001',
                authToken: '2|iT0DSxrTDxhrw6YfOoAp0KRzFc1q9MGXpLocVFQdc9775ef2',
                workspaceId: 'demo-advanced-editors-789',
                userId: 2,
                userName: 'Advanced Editor User'
            });
            
            // Initialize document editor
            documentEditor = new CollaborativeDocumentEditor(wsClient, 'demo-container');
            
            // Initialize individual editors
            initializeRichTextEditor();
            initializeCodeEditor();
            initializeWhiteboard();
            initializeTableEditor();
        }
        
        function initializeRichTextEditor() {
            const container = document.getElementById('rich-text-editor-container');
            richTextEditor = new CollaborativeRichTextEditor(wsClient, container);
            
            const initialContent = `
                <h1>Welcome to Advanced Document Editing</h1>
                <p>This is a <strong>rich text editor</strong> with real-time collaboration features.</p>
                <p>You can format text with <em>italic</em>, <u>underline</u>, and <span style="color: red;">colors</span>.</p>
                <ul>
                    <li>Create lists</li>
                    <li>Add links and images</li>
                    <li>Insert tables</li>
                    <li>Add comments</li>
                </ul>
                <p>Try editing this content and see the real-time collaboration in action!</p>
            `;
            
            richTextEditor.create('rich-text-demo', initialContent);
        }
        
        function initializeCodeEditor() {
            const container = document.getElementById('code-editor-container');
            codeEditor = new CollaborativeCodeEditor(wsClient, container);
            
            const initialCode = `// Welcome to the Collaborative Code Editor
// This editor supports multiple languages with syntax highlighting

function helloWorld() {
    console.log("Hello, World!");
    
    // Real-time collaboration features:
    // - Live cursor tracking
    // - Simultaneous editing
    // - Syntax highlighting
    // - Find & replace
    // - Auto-completion
    
    return "Collaborative coding is awesome!";
}

// Try editing this code with multiple users
helloWorld();`;
            
            codeEditor.create('code-demo', initialCode, 'javascript');
        }
        
        function initializeWhiteboard() {
            const container = document.getElementById('whiteboard-container');
            whiteboard = new CollaborativeWhiteboard(wsClient, container);
            
            whiteboard.create('whiteboard-demo');
        }
        
        function initializeTableEditor() {
            const container = document.getElementById('table-editor-container');
            tableEditor = new CollaborativeTableEditor(wsClient, container);
            
            const initialData = {
                rows: 8,
                cols: 5,
                data: [
                    ['Product', 'Price', 'Quantity', 'Total', 'Status'],
                    ['Laptop', '1299.99', '2', '2599.98', 'In Stock'],
                    ['Mouse', '29.99', '5', '149.95', 'In Stock'],
                    ['Keyboard', '89.99', '3', '269.97', 'Limited'],
                    ['Monitor', '299.99', '1', '299.99', 'In Stock'],
                    ['Webcam', '79.99', '2', '159.98', 'Out of Stock'],
                    ['Speakers', '49.99', '1', '49.99', 'In Stock'],
                    ['Total', '', '', '3529.86', '']
                ]
            };
            
            tableEditor.create('table-demo', initialData);
        }
        
        function setupTabSwitching() {
            const tabs = document.querySelectorAll('.editor-tab');
            const containers = document.querySelectorAll('.editor-container');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetEditor = tab.dataset.editor;
                    
                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Update active container
                    containers.forEach(c => c.classList.remove('active'));
                    document.querySelector(`[data-editor="${targetEditor}"]`).classList.add('active');
                });
            });
        }
        
        async function autoInitializeCollaboration() {
            // Automatically initialize collaboration
            setTimeout(async () => {
                await initializeCollaboration();
            }, 1000);
        }
        
        async function initializeCollaboration() {
            if (!wsClient) return;
            
            try {
                // Join workspace
                const result = await wsClient.joinWorkspace('demo-advanced-editors-789');
                
                // Show success message
                showNotification('Collaboration initialized successfully!', 'success');
                
                // Update UI
                updateCollaborationStatus('Connected', result.current_users.length);
                
                console.log('Collaboration initialized:', result);
            } catch (error) {
                console.error('Failed to initialize collaboration:', error);
                showNotification('Failed to initialize collaboration: ' + error.message, 'error');
            }
        }
        
        function simulateMultipleUsers() {
            // Simulate multiple users for demonstration
            const users = [
                { id: 3, name: 'Alice', color: '#FF6B6B' },
                { id: 4, name: 'Bob', color: '#4ECDC4' },
                { id: 5, name: 'Charlie', color: '#45B7D1' }
            ];
            
            users.forEach((user, index) => {
                setTimeout(() => {
                    simulateUserActivity(user);
                }, index * 2000);
            });
            
            showNotification('Simulating multiple users...', 'info');
        }
        
        function simulateUserActivity(user) {
            // Simulate user joining
            if (wsClient) {
                wsClient.trigger('user.joined', {
                    user_id: user.id,
                    user_name: user.name,
                    timestamp: new Date().toISOString()
                });
            }
            
            // Simulate cursor movement
            setTimeout(() => {
                if (wsClient) {
                    wsClient.trigger('cursor.moved', {
                        user_id: user.id,
                        user_name: user.name,
                        cursor_position: {
                            x: Math.random() * 800,
                            y: Math.random() * 600
                        },
                        timestamp: new Date().toISOString()
                    });
                }
            }, 1000);
        }
        
        function exportAllContent() {
            const content = {
                rich_text: richTextEditor ? document.querySelector('.editor-content').innerHTML : '',
                code: codeEditor ? document.querySelector('.code-textarea').value : '',
                table: tableEditor ? tableEditor.tables.get('table-demo')?.data : [],
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(content, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `advanced_editors_export_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Content exported successfully!', 'success');
        }
        
        function showCollaborationStats() {
            const stats = {
                active_users: wsClient?.workspaceId ? 1 : 0,
                documents: {
                    rich_text: richTextEditor ? 1 : 0,
                    code: codeEditor ? 1 : 0,
                    whiteboard: whiteboard ? 1 : 0,
                    table: tableEditor ? 1 : 0
                },
                features: [
                    'Real-time collaboration',
                    'Live cursor tracking',
                    'Simultaneous editing',
                    'Conflict resolution',
                    'Version history',
                    'Comments system',
                    'Activity feed'
                ]
            };
            
            alert(`Collaboration Statistics:\n\nActive Users: ${stats.active_users}\nDocuments: ${Object.values(stats.documents).reduce((a, b) => a + b, 0)}\nFeatures: ${stats.features.length} advanced features`);
        }
        
        function updateCollaborationStatus(status, userCount) {
            const statusElements = document.querySelectorAll('.collaboration-status');
            statusElements.forEach(el => {
                el.textContent = `${status} (${userCount} users)`;
            });
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#cce7ff'};
                color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#004085'};
                padding: 12px 16px;
                border-radius: 6px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                z-index: 10000;
                max-width: 300px;
                font-size: 14px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // Global functions for testing
        window.wsClient = wsClient;
        window.documentEditor = documentEditor;
        window.richTextEditor = richTextEditor;
        window.codeEditor = codeEditor;
        window.whiteboard = whiteboard;
        window.tableEditor = tableEditor;
    </script>
</body>
</html>